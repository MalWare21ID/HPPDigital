<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Resep & HPP Digital</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel (Untuk menjalankan JSX di browser langsung) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; padding: 0 !important; }
            .card { border: 1px solid #e2e8f0 !important; box-shadow: none !important; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        // Mengambil fungsi React dari global object karena tidak pakai 'import'
        const { useState, useMemo, useEffect } = React;

        // Komponen Icon untuk Lucide
        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => {
                if (window.lucide) { window.lucide.createIcons(); }
            }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const [recipeName, setRecipeName] = useState('Resep Masakan Baru');
            const [portions, setPortions] = useState(1);
            const [ingredients, setIngredients] = useState([
                { id: 1, name: 'Bahan Contoh', bulkQty: 1000, bulkUnit: 'gr', bulkPrice: 50000, usedQty: 100, usedUnit: 'gr' }
            ]);
            const [overhead, setOverhead] = useState({ packaging: 0, labor: 0, other: 0 });
            const [targetMargin, setTargetMargin] = useState(30);

            const units = ['gr', 'kg', 'ml', 'L', 'pcs', 'butir', 'sdm', 'sdt'];

            const addIngredient = () => {
                setIngredients([...ingredients, { 
                    id: Date.now(), name: '', bulkQty: 1000, bulkUnit: 'gr', bulkPrice: 0, usedQty: 0, usedUnit: 'gr' 
                }]);
            };

            const updateIngredient = (id, field, value) => {
                setIngredients(ingredients.map(ing => ing.id === id ? { ...ing, [field]: value } : ing));
            };

            const deleteIngredient = (id) => {
                setIngredients(ingredients.filter(ing => ing.id !== id));
            };

            const calculateCost = (ing) => {
                if (!ing.bulkQty || !ing.bulkPrice || !ing.usedQty) return 0;
                let bQty = parseFloat(ing.bulkQty);
                let uQty = parseFloat(ing.usedQty);
                if (ing.bulkUnit === 'kg' || ing.bulkUnit === 'L') bQty *= 1000;
                if (ing.usedUnit === 'kg' || ing.usedUnit === 'L') uQty *= 1000;
                return (uQty / bQty) * parseFloat(ing.bulkPrice);
            };

            const totals = useMemo(() => {
                const ingredientTotal = ingredients.reduce((acc, ing) => acc + calculateCost(ing), 0);
                const ohTotal = (Number(overhead.packaging) + Number(overhead.labor) + Number(overhead.other)) * portions;
                const productionTotal = ingredientTotal + ohTotal;
                const hppPerPortion = productionTotal / (portions || 1);
                const sellingPrice = hppPerPortion / (1 - (targetMargin / 100));
                return {
                    ingredients: ingredientTotal,
                    overhead: ohTotal,
                    total: productionTotal,
                    hpp: hppPerPortion,
                    selling: sellingPrice,
                    profit: sellingPrice - hppPerPortion
                };
            }, [ingredients, portions, overhead, targetMargin]);

            const formatIDR = (num) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num);

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-8">
                    {/* Header */}
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 no-print">
                        <div>
                            <h1 className="text-3xl font-extrabold text-slate-900 flex items-center gap-3">
                                <div className="p-2 bg-orange-500 rounded-lg text-white">
                                    <Icon name="calculator" size={28} />
                                </div>
                                Kalkulator Resep
                            </h1>
                            <p className="text-slate-500 mt-1">Hitung HPP & Harga Jual secara otomatis.</p>
                        </div>
                        <div className="flex gap-2 w-full md:w-auto">
                            <button onClick={() => window.print()} className="flex-1 md:flex-none flex items-center justify-center gap-2 bg-slate-900 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-black transition shadow-lg">
                                <Icon name="printer" size={18} /> Cetak / PDF
                            </button>
                            <button onClick={() => confirm('Reset semua data?') && window.location.reload()} className="p-2.5 border border-slate-200 rounded-xl hover:bg-white transition">
                                <Icon name="rotate-ccw" size={18} />
                            </button>
                        </div>
                    </div>

                    {/* Print Only Header */}
                    <div className="hidden print:block mb-10 border-b-4 border-slate-900 pb-4 text-center">
                        <h1 className="text-3xl font-black uppercase">Laporan Analisis Biaya Kuliner</h1>
                        <p className="text-sm text-slate-500 mt-2">Dibuat pada: {new Date().toLocaleDateString('id-ID', {dateStyle:'full'})}</p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 print:block">
                        <div className="lg:col-span-2 space-y-6">
                            {/* Meta Data */}
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card print:border-none print:p-0">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2">Nama Menu</label>
                                        <input type="text" value={recipeName} onChange={e => setRecipeName(e.target.value)} className="w-full text-xl font-bold border-b-2 border-slate-100 focus:border-orange-500 outline-none pb-1 no-print" />
                                        <p className="hidden print:block text-2xl font-black text-slate-900">{recipeName}</p>
                                    </div>
                                    <div>
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2">Total Hasil (Porsi)</label>
                                        <input type="number" value={portions} onChange={e => setPortions(Number(e.target.value))} className="w-full text-xl font-bold border-b-2 border-slate-100 focus:border-orange-500 outline-none pb-1 no-print" />
                                        <p className="hidden print:block text-2xl font-black text-slate-900">{portions} Porsi</p>
                                    </div>
                                </div>
                            </div>

                            {/* Ingredients Table */}
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden card print:rounded-none">
                                <div className="p-4 bg-slate-50 border-b flex justify-between items-center no-print">
                                    <h2 className="font-bold flex items-center gap-2"><Icon name="package" className="text-orange-500" /> Daftar Bahan Baku</h2>
                                    <button onClick={addIngredient} className="bg-orange-500 text-white px-4 py-1.5 rounded-lg text-sm font-bold hover:bg-orange-600 transition">+ Tambah Bahan</button>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-slate-50 text-[10px] uppercase font-black text-slate-500 print:bg-slate-100 print:text-black">
                                            <tr>
                                                <th className="p-4 text-left">Nama Bahan</th>
                                                <th className="p-4 text-left">Harga Beli</th>
                                                <th className="p-4 text-left">Dipakai</th>
                                                <th className="p-4 text-right">Subtotal</th>
                                                <th className="p-4 w-10 no-print"></th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {ingredients.map(ing => (
                                                <tr key={ing.id} className="group hover:bg-slate-50 transition">
                                                    <td className="p-4">
                                                        <input type="text" value={ing.name} onChange={e => updateIngredient(ing.id, 'name', e.target.value)} className="w-full bg-transparent font-medium outline-none no-print" placeholder="Nama bahan..." />
                                                        <span className="hidden print:block">{ing.name || '-'}</span>
                                                    </td>
                                                    <td className="p-4">
                                                        <div className="no-print flex flex-col gap-1">
                                                            <div className="flex gap-1 items-center">
                                                                <input type="number" value={ing.bulkQty} onChange={e => updateIngredient(ing.id, 'bulkQty', e.target.value)} className="w-16 p-1 border rounded bg-white text-xs" />
                                                                <select value={ing.bulkUnit} onChange={e => updateIngredient(ing.id, 'bulkUnit', e.target.value)} className="text-xs bg-transparent uppercase font-bold">{units.map(u => <option key={u}>{u}</option>)}</select>
                                                            </div>
                                                            <div className="text-[10px] text-slate-400">Rp <input type="number" value={ing.bulkPrice} onChange={e => updateIngredient(ing.id, 'bulkPrice', e.target.value)} className="w-20 bg-transparent border-b border-slate-100 focus:border-orange-500" /></div>
                                                        </div>
                                                        <span className="hidden print:block text-xs">{ing.bulkQty} {ing.bulkUnit} @ {formatIDR(ing.bulkPrice)}</span>
                                                    </td>
                                                    <td className="p-4">
                                                        <div className="no-print flex gap-1 items-center">
                                                            <input type="number" value={ing.usedQty} onChange={e => updateIngredient(ing.id, 'usedQty', e.target.value)} className="w-16 p-1 border rounded bg-orange-50 border-orange-100 text-xs font-bold" />
                                                            <select value={ing.usedUnit} onChange={e => updateIngredient(ing.id, 'usedUnit', e.target.value)} className="text-xs bg-transparent uppercase font-bold">{units.map(u => <option key={u}>{u}</option>)}</select>
                                                        </div>
                                                        <span className="hidden print:block text-sm">{ing.usedQty} {ing.usedUnit}</span>
                                                    </td>
                                                    <td className="p-4 text-right font-bold text-slate-900">{formatIDR(calculateCost(ing))}</td>
                                                    <td className="p-4 no-print">
                                                        <button onClick={() => deleteIngredient(ing.id)} className="text-slate-300 hover:text-red-500 transition"><Icon name="trash-2" size={16} /></button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            {/* Overhead */}
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card print:rounded-none">
                                <h2 className="font-bold mb-4 flex items-center gap-2"><Icon name="box" className="text-orange-500 no-print" /> Biaya Lain / Porsi</h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    {[
                                        {id:'packaging', label:'Kemasan', icon:'package'},
                                        {id:'labor', label:'Tenaga Kerja', icon:'users'},
                                        {id:'other', label:'Lain-lain', icon:'zap'}
                                    ].map(item => (
                                        <div key={item.id} className="bg-slate-50 p-4 rounded-xl print:bg-white print:p-0">
                                            <label className="text-[10px] font-black text-slate-400 uppercase block mb-1">{item.label}</label>
                                            <div className="flex items-center gap-2 no-print">
                                                <span className="text-xs text-slate-400">Rp</span>
                                                <input type="number" value={overhead[item.id]} onChange={e => setOverhead({...overhead, [item.id]: e.target.value})} className="w-full bg-transparent font-bold outline-none border-b border-slate-200 focus:border-orange-500" />
                                            </div>
                                            <p className="hidden print:block font-bold">{formatIDR(overhead[item.id])}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Analysis Sidebar */}
                        <div className="print:mt-10">
                            <div className="bg-slate-900 text-white p-8 rounded-[2rem] shadow-2xl sticky top-8 print:bg-white print:text-black print:shadow-none print:border-4 print:border-black print:rounded-none">
                                <h2 className="text-2xl font-black mb-6 border-b border-slate-800 pb-2 print:border-black">Hasil Analisis</h2>
                                
                                <div className="space-y-6 mb-10">
                                    <div className="flex justify-between items-center text-slate-400 print:text-slate-600">
                                        <span className="text-sm uppercase tracking-widest font-bold">Total Bahan</span>
                                        <span className="font-bold text-white print:text-black">{formatIDR(totals.ingredients)}</span>
                                    </div>
                                    <div className="bg-orange-500/10 p-5 rounded-2xl border border-orange-500/20 print:bg-slate-100 print:border-black">
                                        <label className="text-[10px] font-black uppercase text-orange-400 mb-1 block print:text-slate-500">Modal Per Porsi (HPP)</label>
                                        <div className="text-3xl font-black text-white print:text-black">{formatIDR(totals.hpp)}</div>
                                    </div>
                                </div>

                                <div className="mb-8 no-print">
                                    <div className="flex justify-between items-end mb-2">
                                        <label className="text-[10px] font-black uppercase text-slate-500">Target Profit</label>
                                        <span className="text-orange-500 font-black text-lg">{targetMargin}%</span>
                                    </div>
                                    <input type="range" min="5" max="80" step="5" value={targetMargin} onChange={e => setTargetMargin(Number(e.target.value))} className="w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-orange-500" />
                                </div>

                                <div className="space-y-4">
                                    <div className="bg-white p-6 rounded-2xl text-center print:bg-black print:text-white print:rounded-none">
                                        <p className="text-[10px] font-black uppercase text-slate-400 mb-1 print:text-slate-400">Harga Jual Rekomendasi</p>
                                        <p className="text-4xl font-black text-slate-900 print:text-white tracking-tighter">{formatIDR(totals.selling)}</p>
                                    </div>
                                    
                                    <div className="bg-emerald-500/10 p-4 rounded-xl flex items-center gap-3 text-emerald-400 border border-emerald-500/20 print:text-black print:bg-emerald-50 print:border-emerald-200">
                                        <Icon name="trending-up" size={20} />
                                        <div className="text-xs">Potensi Laba: <b className="text-white print:text-black ml-1">{formatIDR(totals.profit)}</b> / porsi</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <footer className="mt-16 py-8 border-t border-slate-200 text-center text-slate-400 no-print">
                        <p className="text-xs">Â© {new Date().getFullYear()} HPP Digital - <a href="https://www.instagram.com/maliki_yasykur">By.Maliki Yasykur.</a></p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


